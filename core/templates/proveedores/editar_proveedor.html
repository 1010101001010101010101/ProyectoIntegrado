{% extends 'base.html' %}

{% block title %}
    Editar Proveedor - Dulcería Lilis
{% endblock %}

{% block extra_css %}
<style>
    .page-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 2rem;
    }

    .page-title {
        font-size: 2rem;
        color: var(--text-dark);
        font-weight: 700;
    }

    .steps-container {
        background: white;
        border-radius: 12px;
        padding: 2rem;
        box-shadow: 0 2px 12px var(--shadow);
        margin-bottom: 2rem;
    }

    .steps-header {
        display: flex;
        justify-content: center;
        margin-bottom: 2rem;
        gap: 1rem;
    }

    .step-indicator {
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .step-number {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: var(--border);
        color: var(--text-gray);
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 700;
        font-size: 1.1rem;
    }

    .step-label {
        font-size: 0.9rem;
        color: var(--text-gray);
        font-weight: 600;
    }

    .step-divider {
        width: 60px;
        height: 2px;
        background: var(--border);
        margin: 0 0.5rem;
    }

    .card-option {
        background: white;
        border: 2px solid var(--border);
        border-radius: 12px;
        padding: 2rem;
        margin-bottom: 1.5rem;
        cursor: pointer;
        transition: all 0.3s ease;
        text-decoration: none;
        display: block;
    }

    .card-option:hover {
        border-color: #ff1900;
        box-shadow: 0 4px 16px rgba(255, 25, 0, 0.3);
        transform: translateY(-2px);
        background: linear-gradient(135deg, rgba(255, 217, 0, 0.05) 0%, rgba(211, 39, 39, 0.05) 100%);
    }

    .card-header {
        display: flex;
        align-items: center;
        gap: 1rem;
        margin-bottom: 1rem;
    }

    .card-icon {
        font-size: 2.5rem;
    }

    .card-title {
        font-size: 1.5rem;
        color: var(--text-dark);
        font-weight: 700;
        margin: 0;
    }

    .card-description {
        color: var(--text-gray);
        line-height: 1.6;
        margin: 0;
    }

    .btn-back {
        background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
        color: white;
        padding: 0.8rem 1.5rem;
        border-radius: 10px;
        text-decoration: none;
        font-weight: 600;
        transition: all 0.3s ease;
        display: inline-block;
        box-shadow: 0 4px 15px rgba(243, 4, 4, 0.3);
    }

    .btn-back:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 25px rgba(207, 4, 4, 0.5);
    }

    .proveedor-info {
        background: linear-gradient(135deg, rgba(255, 217, 0, 0.1) 0%, rgba(211, 39, 39, 0.1) 100%);
        border-left: 4px solid var(--primary-dark);
        border-radius: 12px;
        padding: 1.5rem;
        margin-bottom: 2rem;
    }

    .proveedor-info h3 {
        color: var(--text-dark);
        font-size: 1.3rem;
        font-weight: 700;
        margin-bottom: 0.8rem;
    }

    .proveedor-details {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 1rem;
    }

    .detail-item {
        display: flex;
        flex-direction: column;
        gap: 0.3rem;
    }

    .detail-label {
        color: var(--text-gray);
        font-size: 0.85rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .detail-value {
        color: var(--text-dark);
        font-size: 1rem;
        font-weight: 600;
    }

    .edit-form {
        background: white;
        border-radius: 16px;
        box-shadow: 0 8px 32px rgba(15, 23, 42, 0.12);
        padding: 2.25rem;
    }

    .form-section {
        border-bottom: 1px solid var(--border);
        padding-bottom: 1.75rem;
        margin-bottom: 1.75rem;
    }

    .form-section:last-of-type {
        border-bottom: none;
        margin-bottom: 0;
        padding-bottom: 0;
    }

    .form-section h2 {
        font-size: 1.35rem;
        font-weight: 700;
        color: var(--text-dark);
        margin-bottom: 0.35rem;
    }

    .form-section p {
        margin: 0 0 1.25rem;
        color: var(--text-gray);
        font-size: 0.92rem;
    }

    .form-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
        gap: 1.25rem 1.5rem;
    }

    .form-group label {
        display: block;
        font-size: 0.82rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        color: var(--text-gray);
        margin-bottom: 0.35rem;
    }

    .form-group input,
    .form-group select,
    .form-group textarea {
        width: 100%;
        border: 1px solid #d7dcef;
        border-radius: 12px;
        padding: 0.65rem 0.85rem;
        font-size: 0.95rem;
        background: #f8fafc;
        transition: border-color 0.2s ease, box-shadow 0.2s ease;
    }

    .form-group textarea {
        min-height: 140px;
        resize: vertical;
    }

    .form-group input:focus,
    .form-group select:focus,
    .form-group textarea:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 0 4px rgba(209, 29, 29, 0.18);
        background: white;
    }

    .form-group.span-2 {
        grid-column: span 2;
    }

    .form-errors,
    .errorlist {
        margin-top: 0.5rem;
        color: #dc2626;
        font-size: 0.85rem;
        list-style: none;
        padding-left: 0;
    }

    .form-actions {
        display: flex;
        justify-content: flex-end;
        gap: 1rem;
        margin-top: 2.25rem;
    }

    .btn-primary {
        background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
        color: #fff;
        border: none;
        padding: 0.85rem 1.75rem;
        border-radius: 12px;
        font-weight: 600;
        cursor: pointer;
        transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    .btn-primary:hover {
        transform: translateY(-1px);
        box-shadow: 0 15px 30px rgba(209, 29, 29, 0.25);
    }

    .btn-secondary {
        background: #e2e8f0;
        color: #1f2937;
        padding: 0.85rem 1.75rem;
        border-radius: 12px;
        font-weight: 600;
        text-decoration: none;
        transition: background 0.2s ease;
    }

    .btn-secondary:hover {
        background: #cbd5f5;
    }

    @media (max-width: 768px) {
        .page-header {
            flex-direction: column;
            gap: 1rem;
            align-items: flex-start;
        }

        .steps-header {
            flex-direction: column;
            align-items: center;
        }

        .step-divider {
            width: 2px;
            height: 40px;
            margin: 0.5rem 0;
        }

        .proveedor-details {
            grid-template-columns: 1fr;
        }

        .form-grid {
            grid-template-columns: 1fr;
        }

        .form-actions {
            flex-direction: column-reverse;
            align-items: stretch;
        }
    }

    .productos-formset {
        display: flex;
        flex-direction: column;
        gap: 1.5rem;
    }

    .producto-form-card {
        background: #f8fafc;
        border: 1px dashed #cbd5f5;
        border-radius: 12px;
        padding: 1.5rem;
    }

    .checkbox-field label {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        font-weight: 600;
        color: var(--text-gray);
    }

    .checkbox-field input {
        width: auto;
        margin: 0;
    }

    .form-hint {
        font-size: 0.82rem;
        color: #64748b;
        margin-top: 0.75rem;
        display: block;
    }
</style>
{% endblock %}

{% block content %}
<div class="page-header">
    <h1 class="page-title">Editar Proveedor</h1>
    <a href="{% url 'core:lista_proveedores' %}" class="btn-back">← Volver a la lista</a>
</div>

<div class="proveedor-info">
    <h3>Información Actual del Proveedor</h3>
    <div class="proveedor-details">
        <div class="detail-item">
            <span class="detail-label">RUT</span>
            <span class="detail-value">{{ proveedor.rut }}</span>
        </div>
        <div class="detail-item">
            <span class="detail-label">Razón Social</span>
            <span class="detail-value">{{ proveedor.razon_social }}</span>
        </div>
        <div class="detail-item">
            <span class="detail-label">Nombre Fantasía</span>
            <span class="detail-value">{{ proveedor.nombre_fantasia|default:"No especificado" }}</span>
        </div>
        <div class="detail-item">
            <span class="detail-label">Email</span>
            <span class="detail-value">{{ proveedor.email|default:"No especificado" }}</span>
        </div>
    </div>
</div>

<form method="post" class="edit-form">
    {% csrf_token %}

    {% if form.non_field_errors %}
        <div class="form-errors">{{ form.non_field_errors }}</div>
    {% endif %}

    <div class="form-section">
        <h2>Paso 1: Identificación y contacto</h2>
        <p>Actualiza los datos básicos de identificación y contacto del proveedor.</p>
        <div class="form-grid">
            <div class="form-group">
                <label for="{{ form.rut.id_for_label }}">RUT</label>
                {{ form.rut }}
                {{ form.rut.errors }}
            </div>
            <div class="form-group">
                <label for="{{ form.razon_social.id_for_label }}">Razón social</label>
                {{ form.razon_social }}
                {{ form.razon_social.errors }}
            </div>
            <div class="form-group">
                <label for="{{ form.nombre_fantasia.id_for_label }}">Nombre fantasía</label>
                {{ form.nombre_fantasia }}
                {{ form.nombre_fantasia.errors }}
            </div>
            <div class="form-group">
                <label for="{{ form.telefono.id_for_label }}">Teléfono</label>
                {{ form.telefono }}
                {{ form.telefono.errors }}
            </div>
            <div class="form-group">
                <label for="{{ form.email.id_for_label }}">Correo electrónico</label>
                {{ form.email }}
            </div>
            <div class="form-group span-2">
                <label for="{{ form.sitio_web.id_for_label }}">Sitio web</label>
                {{ form.sitio_web }}
            </div>
        </div>
    </div>

    <div class="form-section">
        <h2>Paso 2: Dirección comercial</h2>
        <p>Modifica la dirección fiscal y comercial del proveedor.</p>
        <div class="form-grid">
            <div class="form-group span-2">
                <label for="{{ form.direccion.id_for_label }}">Dirección</label>
                {{ form.direccion }}
                {{ form.direccion.errors }}
            </div>
            <div class="form-group">
                <label for="{{ form.comuna.id_for_label }}">Comuna</label>
                {{ form.comuna }}
                {{ form.comuna.errors }}
            </div>
            <div class="form-group">
                <label for="{{ form.ciudad.id_for_label }}">Ciudad</label>
                {{ form.ciudad }}
                {{ form.ciudad.errors }}
            </div>
            <div class="form-group">
                <label for="{{ form.region.id_for_label }}">Región</label>
                {{ form.region }}
                {{ form.region.errors }}
            </div>
        </div>
    </div>

    <div class="form-section">
        <h2>Paso 3: Contactos y estado</h2>
        <p>Gestiona la información operacional del proveedor.</p>
        <div class="form-grid">
            <div class="form-group">
                <label for="{{ form.estado.id_for_label }}">Estado</label>
                {{ form.estado }}
            </div>
            <div class="form-group">
                <label for="{{ form.lead_time.id_for_label }}">Lead Time (días)</label>
                {{ form.lead_time }}
            </div>
            <div class="form-group">
                <label for="{{ form.pedido_minimo.id_for_label }}">Pedido mínimo</label>
                {{ form.pedido_minimo }}
            </div>
            <div class="form-group checkbox-field">
                <label>
                    {{ form.es_proveedor_preferente }}
                    <span>Proveedor preferente</span>
                </label>
            </div>
            <div class="form-group span-2">
                <label for="{{ form.observaciones.id_for_label }}">Observaciones</label>
                {{ form.observaciones }}
            </div>
        </div>
    </div>

    <div class="form-actions">
        <a href="{% url 'core:lista_proveedores' %}" class="btn-secondary">Cancelar</a>
        <button type="submit" class="btn-primary">Guardar cambios</button>
    </div>

    <div class="form-section">
        <h2>Paso 4: Productos asociados (opcional)</h2>
        <p>Vincula productos al proveedor o deja los campos vacíos para agregarlos más tarde.</p>
        {{ formset.management_form }}
        <div class="productos-formset">
            {% for producto_form in formset.forms %}
                <div class="producto-form-card">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="{{ producto_form.producto.id_for_label }}">Producto</label>
                            {{ producto_form.producto }}
                            {{ producto_form.producto.errors }}
                        </div>
                        <div class="form-group">
                            <label for="{{ producto_form.costo.id_for_label }}">Costo</label>
                            {{ producto_form.costo }}
                            {{ producto_form.costo.errors }}
                        </div>
                        <div class="form-group">
                            <label for="{{ producto_form.lead_time.id_for_label }}">Lead Time (días)</label>
                            {{ producto_form.lead_time }}
                            {{ producto_form.lead_time.errors }}
                        </div>
                        <div class="form-group checkbox-field">
                            <label>
                                {{ producto_form.activo }}
                                <span>Activo</span>
                            </label>
                            {{ producto_form.activo.errors }}
                        </div>
                    </div>
                    <div class="checkbox-field">
                        <label>
                            {{ producto_form.DELETE }}
                            <span>Eliminar este producto</span>
                        </label>
                        {{ producto_form.DELETE.errors }}
                    </div>
                    {% if producto_form.non_field_errors %}
                        <ul class="errorlist">
                            {% for error in producto_form.non_field_errors %}
                                <li>{{ error }}</li>
                            {% endfor %}
                        </ul>
                    {% endif %}
                </div>
            {% endfor %}
        </div>
        <span class="form-hint">Se guardarán únicamente los productos con datos completos y sin marcar como eliminados.</span>
    </div>
</form>
{% endblock %}